
@{
    ViewBag.Title = "BookieOddsEntry";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link href="@Url.Content("~/plugins/daterangepicker/daterangepicker.css")" rel="stylesheet" type="text/css" />
}
<!-- Content Header (Page header) -->
<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1>လောင်းကြေးများ ဖြည့်သွင်းရန်</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item active">Match Entry</li>
                </ol>
            </div>
        </div>
    </div><!-- /.container-fluid -->
</section>
<!-- Main content -->
<section class="content">
    <div id="TeamList">
    </div>
    <div class="card">
        <div class="card-body">
            <div class="form-row">
                <div class="form-group col-xl-2 col-md-4">
                    <label for="matchdate">ပွဲကစားမည့်နေ့</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text text-custom2" id="basic-addon1"><i class="fa fa-calendar-alt"></i></span>
                        </div>
                        <input readonly="readonly" type="text" class="form-control float-right" id="matchdate" onchange="DateChange();">
                    </div>
                </div>
            </div>
            <table id="tblMatch" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th></th>
                        <th>ပွဲချိန်</th>
                        <th></th>
                        <th>ဘော်ဒီကြေး</th>
                        <th>Home</th>
                        <th>Away</th>
                        <th></th>
                        <th>ဘော်ဒီကြေး</th>
                        <th></th>
                        <th>ဂိုးပေါင်း</th>
                    </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                </tfoot>
            </table>
        </div>
        <div class="card-footer">
            <div style="text-align:center;">
                <button type="button" id="btnSave" onclick="Save();" class="btn btn-success">သိမ်းဆည်းမည်</button>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal-default">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">ကြေးရွေးချယ်ရန်</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <input id="BodyOddsId" type="hidden" value="" />
                        <label class="col-xl-1 md-1">ဘော်ဒီ</label>
                        <label id="lblBodyOdds" class="col-xl-1 md-1"></label>
                    </div>
                    <div class="row">
                        <input id="GoalOddsId" type="hidden" value="" />
                        <label class="col-xl-1 md-1">ဂိုးပေါင်း</label>
                        <label id="lblGoalOdds" class="col-xl-1 md-1"></label>
                    </div>
                    <div id="OddsList">
                    </div>
                </div>
                <div class="modal-footer">
                    <div>
                        <button type="button" id="btnSave" onclick="Save();" class="btn btn-success">အတည်ပြုမည်</button>
                    </div>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
</section>

@section Scripts{
    <script src="@Url.Content("~/plugins/daterangepicker/moment.min.js")"></script>
    <script src="@Url.Content("~/plugins/daterangepicker/daterangepicker.js")"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#matchdate').daterangepicker({
                timePicker: false, //<==MAKE THE CHANGE HERE
                singleDatePicker: true, //<==MAKE THE CHANGE HERE
                locale: {
                    format: 'DD-MM-YYYY'
                }
            });

            $("tbody", "#tblMatch").on("click", "td:eq(1),td:eq(4)",
                function () {
                    $('#modal-default').modal('show')
                    //alert(this.innerText);
                });

            GetOdds();

        });

        function GetOdds() {
            $.ajax({
                url: '@Url.Action("GetOdds", "Odds")',
                type: "GET",
                dataType: "JSON",
                dataSrc: '',
                success: function (res) {
                    BindOdds(res);
                }
            })
        }

        function RemoveBtnColor(OddsTypeID) {
            $("#card"+OddsTypeID+ " .btn-danger").each(function () {
                $(this).removeClass('btn-danger');
                $(this).addClass('btn-default')
            });
        }

        function Add(btn, OddsId, OddsTitleID, OddsTypeID) {
            RemoveBtnColor(OddsTypeID)

            if (!$(btn).hasClass('btn-danger')) {
                $(btn).removeClass('btn-default');
                $(btn).addClass('btn-danger');

                if (OddsTypeID == 1) {
                    $("#lblBodyOdds").html($(btn).html());
                    $("#BodyOddsId").val(OddsId);

                    $('#card1').CardWidget('collapse');
                    $('#card2').CardWidget('expand');
                }
                else if (OddsTypeID == 2) {
                    $("#lblGoalOdds").html($(btn).html());
                    $("#GoalOddsId").val(OddsId);

                    $('#card2').CardWidget('collapse');
                }
            }
            else {
                $(btn).removeClass('btn-danger');
                $(btn).addClass('btn-default');
                if (OddsTypeID == 1) {
                    $("#lblBodyOdds").html('');
                }
                else if (OddsTypeID == 2) {
                    $("#lblGoalOdds").html('');
                }
            }            
        }

        function BindOdds(res) {
            var cl = $("#OddsList");
            cl.empty();
            var e = '';
            var OddsTypeID = '';
            var OddsTitleID = '';
            for (var i = 0; i < res.length; i++) {
                if (OddsTypeID != res[i].OddsTypeID) {
                    if (OddsTypeID) {
                        e = e + '</div>' +
                            '</div>';
                    }

                    e = e + '<div class="card collapsed-card" id="card' + res[i].OddsTypeID + '">' +
                        '<div class="card-header bg-cyan">' +
                        '<h3 class="card-title">' + res[i].OddsTypeName + '</h3>' +
                        '<div class="card-tools">' +
                        '<button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip" title="Collapse">' +
                        '<i class="fas fa-plus"></i>' +
                        '</button>' +
                        '</div>' +
                        '</div>' +
                        '<div class="card-body">' +
                        '<div class="row mb-1"><b>' + res[i].OddsTitle + '</b></div>' +
                        '<button type="button" id="btn' + res[i].OddsID + '" onclick="Add(this,' + res[i].OddsID + ',' + res[i].OddsTitleID + ',' + res[i].OddsTypeID +')" class="btn btn-default col-md-3 col-xl-2 mb-1">' +
                        res[i].OddsName +
                        '</button>'
                }
                else {
                    if (OddsTitleID != res[i].OddsTitleID) {
                        e = e + '<div class="row mb-1"><b>' + res[i].OddsTitle + '</b></div>' +
                            '<button type="button" id="btn' + res[i].OddsID + '" onclick="Add(this,' + res[i].OddsID + ',' + res[i].OddsTitleID + ',' + res[i].OddsTypeID +')" class="btn btn-default col-md-3 col-xl-2 mb-1">' +
                            res[i].OddsName +
                            '</button>'
                    }
                    else {
                        e = e + '<button type="button" id="btn' + res[i].OddsID + '" onclick="Add(this,' + res[i].OddsID + ',' + res[i].OddsTitleID + ',' + res[i].OddsTypeID +')" class="btn btn-default col-md-3 col-xl-2 mb-1">' +
                            res[i].OddsName +
                            '</button>'
                    }
                }
                OddsTypeID = res[i].OddsTypeID;
                OddsTitleID = res[i].OddsTitleID;

            }
            cl.append(e);
        }

        function DateChange() {          
            BindMatch();
        }

        function BindMatch() {
            var table = $('#tblMatch').DataTable(
                {
                    "language": {
                        "info": "Display _START_ to _END_ of _TOTAL_ records",
                    },
                    "oLanguage": {
                        "sLengthMenu": "Display _MENU_ records",
                    },
                    "ajax": {
                        "url": '@Url.Action("GetMatch", "Match")?MatchDate='+$("#matchdate").val()+'',
                        "type": "GET",
                        "datatype": "json",
                        "dataSrc": ""
                    },
                    "searching": false,
                    "responsive": true,
                    "order": [[1, "desc"]],
                    "autoWidth": false,
                    "destroy": "true",
                    "paging": false,
                    "columns": [
                        { "data": "MatchID" },
                        { "data": "MatchTime" },
                        { "data":"Team1OddsID"},
                        { "data": "Team1Odds"},
                        { "data": "Home"},
                        { "data": "Away"},
                        { "data": "Team2OddsID"},
                        { "data": "Team2Odds" },
                        { "data": "GoalOddsID" },
                        { "data": "GoalOdds" },
                    ],
                    "columnDefs": [
                        {
                            "targets": [0,2,6,8],
                            "visible": false,
                            "searchable": false
                        },
                    ]
                }
            );
        }
    </script>
}
